<html>
    <head>
    	<style>
    		.main {
				margin-top: 100px;
    		}
    		input[type='text'] {
    			border-style: none;
    			background: lightgreen;
    		}

			input:hover, input:focus{
				outline: none;
			}			

			input[type="submit"] {				
				width: 70px;
				margin-left: 400px;
			}
			#main_list {
				border-style: groove;
				border-width: 2px;
				width: 500px;
				max-height: 100px;	/* this have height of list dynamic adjusting */
				margin-left: 400px;
				padding: 0;		
				overflow: auto;	/* this make tags not out of main_list */						
			}			

			li {
				list-style: none;
				display: inline-block;
				float: left;	
				margin: 2px 5px 2px 0;
			}

			#closed_tag{
				background: lightblue;
			}

			#filter {
				border-style: solid;
				border-width: 2px;
				border-color: red;
				border-radius: 5px;
				box-shadow: 4px 4px 3px rgba(20%,20%,40%,0.5);
				width: 200px;

				/* following makes filter not hidden when main_list is overflow:auto */
				position: absolute;		
				z-index: 1;				
			}
			#filter > li {				
				display: block;
				float: none;			
			}
			#filter > li:hover{
				background: yellow;
				cursor: pointer;
			}

			.removal {
				cursor: pointer;				
			}

			.removal:hover {
				color: red;
			}

    	</style>
    </head>    
    <body>
        <div class="main">        	
        	<!-- disable form submit, replaced with input (onkeypress:keyCode==13) -->
	        <form onsubmit="return false"> 
	        	<input type="submit" id="submit" disabled />     
	        	<ul id="main_list">	       				
	       			<li>
	       				<span id="new_tag" style="display: hidden;"></span>
	       			</li>
	       			<li id="inputItem">
	       				<input type="text" id="keyin" list="timezone" onkeyup="query(this.value)" autocomplete="off" placeholder="Please type city name"/>
	       				<ul id="filter" style="display:none;"></ul>
	       			</li>		       			
	       		</ul>	  		
	        </form>
    	</div>
        <script>
        var timezone = ["Amsterdam", "Andorra", "Athens", "Belfast", "Belgrade","Berlin","Bratislava","Brussels","Bucharest","Budapest","Chișinău","Copenhagen","Dublin","Gibraltar","Guernsey","Helsinki","Isle_of_Man","Istanbul","Jersey","Kaliningrad","Kiev","Lisbon","Ljubljana","London","Luxembourg","Madrid","Malta","Mariehamn","Minsk","Monaco","Moscow","Nicosia","Oslo","Paris","Podgorica","Prague","Riga","Rome","Samara","San_Marino","Sarajevo","Simferopol","Skopje","Sofia","Stockholm","Tallinn","Tirane","Tiraspol","Uzhgorod","Vaduz","Vatican","Vienna","Vilnius","Volgograd","Warsaw","Zagreb","Zaporozhye","Zurich","Adelaide","Brisbane","Broken_Hill","Currie","Darwin","Eucla","Hobart","Lindeman","Lord_Howe","Melbourne","Perth","Sydney","Abidjan","Accra","Addis_Ababa","Algiers","Asmara","Bamako","Bangui","Banjul","Bissau","Blantyre","Brazzaville","Bujumbura","Cairo","Casablanca","Ceuta","Conakry","Dakar","Dar_es_Salaam","Djibouti","Douala","El_Aaiún","Freetown","Gaborone","Harare","Johannesburg","Juba","Kampala","Khartoum","Kigali","Kinshasa","Lagos","Libreville","Lomè","Luanda","Lubumbashi","Lusaka","Malabo","Maputo","Maseru","Mbabane","Mogadishu","Monrovia","Nairobi","N'djamena","Niamey","Nouakchott","Ouagadougou","Porto-Novo","São_Tomé","Timbuktu","Tripoli","Tunis","Windhoek","Aden","Almaty","Amman","Anadyr","Aqtau","Aqtobe","Ashgabat","Ashkhabad","Baghdad","Bahrain","Baku","Bangkok","Beirut","Bishkek","Brunei","Choibalsan","Chongqing","Colombo","Damascus","Dhaka","Dili","Dubai","Dushanbe","Gaza","Harbin","Hebron","Ho_Chi_Minh","Hong_Kong","Hovd","Irkutsk","Istanbul","Jakarta","Jayapura","Jerusalem","Kabul","Kamchatka","Karachi","Kashgar","Kathmandu","Kolkata","Krasnoyarsk","Kuala_Lumpur","Kuching","Kuwait","Macau","Magadan","Makassar","Manila","Muscat","Nicosia","Novokuznetsk","Novosibirsk","Omsk","Oral","Phnom_Penh","Pontianak","Pyongyang","Qatar","Qyzylorda","Rangoon","Riyadh","Saigon","Sakhalin","Samarkand","Seoul","Shanghai","Singapore","Taipei","Tashkent","Tbilisi","Tehran","Tel_Aviv","Thimphu","Tokyo","Ulan_Bator","Vientiane","Vladivostok","Yakutsk","Yekaterinburg","Yerevan","Casey","Davis","DumontDUrville","Macquarie","Mawson","McMurdo","Palmer","Rothera"];

        	 function grep(pattern, callback){

        	 	var result = [];

        	 	for(var i=0; i < timezone.length; i++){
        	 		var city = timezone[i];
        	 		var cond = callback(city, pattern);

        	 		if(cond) {
        	 			result.push(city);
        	 		}        	 		
        	 	}
        	 	return result;
        	 }
        	
        	function removeTag(){
        		alert('removed')        		
        	 }

        	function addTag(text){
				  var tag = document.getElementById('new_tag');

				  // x link is meant for removal (\xd7 is multiplication sign)
	        	  tag.innerHTML = text + " <a class='removal' onclick='removeTag();'>\xd7</a>";	

	        	  // change id:new_tag to id:closed_tag
	        	  tag.id = 'closed_tag';

	        	  tag.style.display = "inline"; 
	        	  
	        	  // create a tag in id:new_tag for next insertion
	        	  var new_tag = document.createElement('span');
	        	  new_tag.id = 'new_tag';
	        	  new_tag.style="display: hidden;";
	        	  var li = document.createElement('li');
	        	  li.appendChild(new_tag);
	        	  var ul = document.getElementById('main_list');
	        	  var inputItem = document.getElementById('inputItem');
	        	  ul.insertBefore(li, inputItem);

	        	  keyin.value = "";			// memory leak?
				  filter.innerHTML = "";	// memory leak?
				  filter.style.display = "none";
        	}

        	function query(text) {

			  var keyin = document.getElementById('keyin');		
			  var filter = document.getElementById('filter');	  
			  filter.innerHTML = ""; 	// clear for each keyin

        	  if(event.keyCode == 13){	// when key for onkeypress is 'enter' or 'return'		        

		        if (text.length != 0) {		
		          addTag(text);
	    		} 

    		  } else {

    		  		var set = [];    

    		  		if(text.length != 0){

    		  			console.log(text.length + '*')
    		  			var pattern = new RegExp("^" + text, "i"); 	// "i" stands for "case-insensitive"
    		  			set = grep(pattern, function(city, pattern){
    		  			// use callback since the number of matching items is large, or if matching remotely, callback can avoid blocking if network is blocked
    		  				return pattern.test(city);
    		  			}); 
    		  			
    		  			if(set.length != 0){    		  				
	    		  			for(var i=0; i < set.length; i++){
	    		  				var li = document.createElement('li');
	    		  				li.innerHTML = set[i];
	    		  				li.onclick = function selectIt(){ 
	    		  					addTag(this.innerHTML); 
	    		  					var submit = document.getElementById('submit');
	    		  					submit.removeAttribute('disabled');
	    		  				};
	    		  				filter.appendChild(li);
	    		  			}
	    		  			filter.style.display = "block";
    		  			} else { // no matching
    		  				filter.style.display = "none";
    		  			}
    		  		} else { 	// delete to no character
    		  				filter.style.display = "none";
    		  		}  		  		
    		  }
        	}

        	/* TODO:								
				1. remove tag (remember disable submit)
				2. make some snippets into function 				
				final. optimize code (efficiency and memory leak)
				More: write explanation and test
        	*/
        </script>
    </body>
</html>